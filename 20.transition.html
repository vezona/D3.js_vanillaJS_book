<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>動畫 transition</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./extension/prism.css" />
    <link rel="stylesheet" href="./css/utils.css" />
  </head>
  <body>
    <nav class="bg-orange navbar">
      <div class="container-fluid">
        <a
          class="text-decoration-none fw-bold navbar-brand"
          href="./index.html"
        >
          <span class="nav-title"> D3.js 圖表繪製教學</span>
        </a>
      </div>
    </nav>

    <div class="container">
      <h3 class="mt-6 fw-bold">動畫 Transitions</h3>

      <!-- 一般改變位置 -->
      <div>
        <h5 class="mt-5">
          <mark>一般改變位置</mark>
        </h5>
        <div class="my-4">
          <svg class="move" style="border: 1px solid rgb(103, 102, 102)"></svg>
          <button type="button" class="mt-3 btn d-block btn-primary moveBtn">
            移動
          </button>
        </div>

        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            // html
            &lt;svg class=&quot;move&quot; 
                 style=&quot;border: 1px solid rgb(103, 102, 102)&quot;&gt;
            &lt;/svg&gt;
            &lt;button type=&quot;button&quot; class=&quot;moveBtn&quot;&gt;
              移動
            &lt;/button&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
            const moveRect = d3
            .select(".move")
            .append("rect")
            .attr("width", 40)
            .attr("height", 40)
            .attr("fill", "#f68b47")
            .attr("stroke", "#f68b47");
    
          document.querySelector(".moveBtn")
              .addEventListener("click", ()=> {
                  moveRect.attr("transform", "translate(140, 60)");
                });
          </code>
        </pre>
      </div>

      <!-- transition -->
      <div>
        <h5 class="mt-5">
          <mark>selection.transition([name])</mark>
        </h5>
        <div class="my-4">
          <svg
            class="transition"
            style="border: 1px solid rgb(103, 102, 102)"
          ></svg>
          <button
            type="button"
            class="mt-3 btn d-block btn-primary transitionBtn"
          >
            平滑移動
          </button>
        </div>

        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            const transitionRect = d3
              .select(".transition")
              .append("rect")
              .attr("width", 40)
              .attr("height", 40)
              .attr("fill", "#f68b47")
              .attr("stroke", "#f68b47");
    
            document
              .querySelector(".transitionBtn")
              .addEventListener("click", ()=> {
                transitionRect.transition()
                            .attr("transform", "translate(140, 60)");
              });
          </code>
        </pre>
      </div>

      <!-- duration -->
      <div>
        <h5 class="mt-5">
          <mark>transition.duration([value])</mark>
        </h5>
        <div class="my-4">
          <svg
            class="duration"
            style="border: 1px solid rgb(103, 102, 102)"
          ></svg>
          <button
            type="button"
            class="mt-3 btn d-block btn-primary durationBtn"
          >
            延長移動
          </button>
        </div>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
          const durationRect = d3
            .select(".duration")
            .append("rect")
            .attr("width", 40)
            .attr("height", 40)
            .attr("fill", "#f68b47")
            .attr("stroke", "#f68b47");
    
          document.querySelector(".moveBtn")
                  .addEventListener("click", () => {
                    moveRect
                      .transition()
                      .duration(5000) // 設定動畫時間持續5秒鐘
                      .attr("transform", "translate(140, 60)");
                  });
          </code>
        </pre>
      </div>

      <!-- duration color -->
      <div>
        <h5 class="mt-5">
          <mark>transition 改變顏色、邊框粗細</mark>
        </h5>
        <div class="my-4">
          <svg
            class="transitionColor"
            style="border: 1px solid rgb(103, 102, 102)"
          ></svg>
          <button
            type="button"
            class="mt-3 btn d-block btn-primary transitionColorBtn"
          >
            改變
          </button>
        </div>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            // html
            &lt;svg class=&quot;transitionColor&quot;
                 style=&quot;border: 1px solid rgb(103, 102, 102)&quot;&gt;&lt;/svg&gt;
            &lt;button type=&quot;button&quot; class=&quot;transitionColorBtn&quot;&gt;
              改變
            &lt;/button&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
          const transitionColor = d3
            .select(".transitionColor")
            .append("rect")
            .attr("width", 40)
            .attr("height", 40)
            .attr("fill", "#f68b47")
            .attr("stroke", "#f68b47")
            .attr("transform", "translate(120, 50)");
    
          document
            .querySelector(".transitionColorBtn")
            .addEventListener("click", () => {
              transitionColor
                .transition()
                .duration(1000)
                .attr("fill", "green")
                .attr("stroke-width", "6px")
                .attr("stroke", "red");
            });
          </code>
        </pre>
      </div>

      <!-- delay -->
      <div>
        <h5 class="mt-5">
          <mark>transition.delay([value])</mark>
        </h5>
        <div class="my-4">
          <svg class="delay" style="border: 1px solid rgb(103, 102, 102)"></svg>
          <button type="button" class="mt-3 btn d-block btn-primary delayBtn">
            delay
          </button>
        </div>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            //html 
            &lt;svg class=&quot;delay&quot;
                 style=&quot;border: 1px solid rgb(103, 102, 102)&quot;&gt;
            &lt;/svg&gt;
            &lt;button type=&quot;button&quot; 
                    class=&quot;mt-3 btn d-block btn-primary delayBtn&quot;&gt;
              delay
            &lt;/button&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
            const dataDelay = [160, 140, 120, 100, 80, 60, 40, 20];
            const delay = d3
              .select(".delay")
              .selectAll("circle")
              .data(dataDelay)
              .enter()
              .append("circle")
              .attr("cx", (d) => d)
              .attr("cy", 30)
              .attr("r", 15)
              .attr("fill", "blue")
              .attr("opacity", "0.5");
      
            document.querySelector(".delayBtn")
                    .addEventListener("click", () => {
                      delay
                        .transition()
                        .delay((d, i) => i * 200) // 分別延遲
                        .attr("cx", (d) => d + 120); // 位移距離
                    });
          </code>
        </pre>
      </div>

      <!-- ease -->
      <div>
        <h5 class="mt-5">
          <mark>transition.ease([value])</mark>
        </h5>
        <div class="my-4">
          <svg class="ease" style="border: 1px solid rgb(103, 102, 102)"></svg>
          <div class="d-flex align-items-baseline">
            <select name="ease" id="ease" class="m-3">
              <option value=""></option>
            </select>
            <button
              type="button"
              class="mt-3 btn btn-primary easeBtn"
              onClick="updateEast()"
            >
              Ease開始
            </button>
          </div>
        </div>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            // html
            &lt;svg class=&quot;ease&quot; 
                 style=&quot;border: 1px solid rgb(103, 102, 102)&quot;&gt;&lt;/svg&gt;
            &lt;div class=&quot;d-flex align-items-baseline&quot;&gt;
              &lt;select name=&quot;ease&quot; id=&quot;ease&quot; class=&quot;m-3&quot;&gt;
                &lt;option value=&quot;&quot;&gt;&lt;/option&gt;
              &lt;/select&gt;
              &lt;button
                type=&quot;button&quot;
                class=&quot;mt-3 btn btn-primary easeBtn&quot;
                onClick=&quot;updateEast()&quot;
              &gt;
                Ease開始
              &lt;/button&gt;
            &lt;/div&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
            const easeDot = d3
                  .select(".ease")
                  .append("circle")
                  .attr("cx", 40)
                  .attr("cy", 40)
                  .attr("r", 30)
                  .attr("fill", "#f68b47");
      
            // 抓出 d3.js 所有API中，名稱帶有ease的API
            const easeNames = Object
                    .keys(d3)
                    .filter((d) => d.slice(0, 4) === "ease");
      
            d3.select("#ease")
              .selectAll("option")
              .data(easeNames)
              .join("option")
              .attr("value", (d) => d)
              .text((d) => `d3.${d}`);
      
            const updateEast = () => {
              const easeName = d3.select("#ease").node().value;
              easeDot
                // 回原點
                .attr("cx", 40)
                .transition()
                // 設定動畫效果
                .ease(d3[easeName])
                .attr("cx", 200);
            };
    
          </code>
        </pre>
      </div>

      <!-- transition.on 無限循環動畫 -->
      <div>
        <h5 class="mt-5">
          <mark>transition.on(typenames[, listener]) 無限循環動畫</mark>
        </h5>
        <div class="my-4">
          <svg
            class="loopAnimation"
            style="border: 1px solid rgb(103, 102, 102)"
          ></svg>
        </div>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            // html
            &lt;svg
              class=&quot;loopAnimation&quot;
              style=&quot;border: 1px solid rgb(103, 102, 102)&quot;&gt;
            &lt;/svg&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
            const loop = d3
              .select(".loopAnimation")
              .append("circle")
              .attr("cx", 50)
              .attr("cy", 50)
              .attr("r", 25)
              .attr("fill", "#f68b47")
              .transition()
              .duration(2000)
              .on("start", goRight);
      
            function goRight() {
              d3.active(this)
                .attr("cx", 200)
                .transition()
                .on("start", goLeft);
            }
      
            function goLeft() {
              d3.active(this)
                .attr("cx", 50)
                .transition()
                .on("start", goRight);
            }
          </code>
        </pre>
      </div>

      <!-- 圖表動畫 -->
      <div>
        <h5 class="mt-5">
          <mark>圖表動畫</mark>
        </h5>
        <div class="my-4 chartAnimation"></div>
        <button type="button" class="mb-4 btn btn-primary chartAnimationBtn">
          動畫開始
        </button>
        <p class="mt-1 mb-1 fs-6">程式碼</p>
        <pre>
          <code class="language-html line-numbers remove-initial-line-feed">
            // html
            &lt;div class=&quot;chartAnimation&quot;&gt;&lt;/div&gt;
            &lt;button type=&quot;button&quot; class=&quot;chartAnimationBtn&quot;&gt;
              動畫開始
            &lt;/button&gt;
          </code>
        </pre>
        <pre>
          <code class="language-js line-numbers remove-initial-line-feed">
            // js
            //定義兩個資料，都是Y值，x值就用陣列索引即可
            const data1 = [
              150, 122, 133, 161, 116, 139, 143, 115, 193, 137, 122, 141,
            ];
            const data2 = [
              180, 146, 180, 172, 133, 149, 152, 138, 188, 192, 117, 146,
            ];
      
            // svg
            const svg = d3
              .select(".chartAnimation")
              .append("svg")
              .attr("width", 500)
              .attr("height", 300);
      
            svg
              .selectAll("rect")
              .data(data1)
              .enter()
              .append("rect")
              .attr("x", 0)
              .attr("y", (d, i) => i * 30)
              .attr("width", (d, i) => d)
              .attr("height", 20)
              .attr("fill", "#f68b47");
      
            // 動畫開始
            d3.select(".chartAnimationBtn").on("click", () => {
              svg
                .selectAll("rect")
                .data(data2) // 資料變化
                .transition() // 加上動畫
                .duration(1000) // 點擊之後每條長柱會在1秒內到達更新位置
                // 每條長柱各自delay後開始動畫，
                // delay 時間乘上index，產生從上至下更新的動畫效果
                .delay((d, i) => 200 * i)
                .attr("width", (d, i) => d)
                .attr("fill", "#66f9ff");
            });
          </code>
        </pre>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="./extension/prism.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      // move ====================================
      const moveRect = d3
        .select(".move")
        .append("rect")
        .attr("width", 40)
        .attr("height", 40)
        .attr("fill", "#f68b47")
        .attr("stroke", "#f68b47");

      document.querySelector(".moveBtn").addEventListener("click", function () {
        moveRect.attr("transform", "translate(140, 60)");
      });

      // transition ====================================
      const transitionRect = d3
        .select(".transition")
        .append("rect")
        .attr("width", 40)
        .attr("height", 40)
        .attr("fill", "#f68b47")
        .attr("stroke", "#f68b47");

      document.querySelector(".transitionBtn").addEventListener("click", () => {
        transitionRect.transition().attr("transform", "translate(140, 60)");
      });

      // duration ====================================
      const durationRect = d3
        .select(".duration")
        .append("rect")
        .attr("width", 40)
        .attr("height", 40)
        .attr("fill", "#f68b47")
        .attr("stroke", "#f68b47");

      document.querySelector(".durationBtn").addEventListener("click", () => {
        durationRect
          .transition()
          .duration(5000) // 設定動畫時間持續5秒鐘
          .attr("transform", "translate(140, 60)");
      });

      // transition color ====================================
      const transitionColor = d3
        .select(".transitionColor")
        .append("rect")
        .attr("width", 40)
        .attr("height", 40)
        .attr("fill", "#f68b47")
        .attr("stroke", "#f68b47")
        .attr("transform", "translate(120, 50)");

      document
        .querySelector(".transitionColorBtn")
        .addEventListener("click", () => {
          transitionColor
            .transition()
            .duration(1000)
            .attr("fill", "green")
            .attr("stroke-width", "6px")
            .attr("stroke", "red");
        });

      // delay ====================================
      const dataDelay = [160, 140, 120, 100, 80, 60, 40, 20];
      const delay = d3
        .select(".delay")
        .selectAll("circle")
        .data(dataDelay)
        .enter()
        .append("circle")
        .attr("cx", (d) => d)
        .attr("cy", 30)
        .attr("r", 15)
        .attr("fill", "#f68b47")
        .attr("opacity", "0.5");

      document.querySelector(".delayBtn").addEventListener("click", () => {
        delay
          .transition()
          .delay((d, i) => i * 200) // 分別延遲
          .attr("cx", (d) => d + 120); // 位移距離
      });

      // ease ====================================
      const easeDot = d3
        .select(".ease")
        .append("circle")
        .attr("cx", 40)
        .attr("cy", 40)
        .attr("r", 30)
        .attr("fill", "#f68b47");

      // 抓出 d3.js 所有API中，名稱有ease的API
      const easeNames = Object.keys(d3).filter((d) => d.slice(0, 4) === "ease");

      console.log(easeNames);

      d3.select("#ease")
        .selectAll("option")
        .data(easeNames)
        .join("option")
        .attr("value", (d) => d)
        .text((d) => `d3.${d}`);

      const updateEast = () => {
        const easeName = d3.select("#ease").node().value;
        easeDot
          // 回原點
          .attr("cx", 40)
          .transition()
          // 設定動畫效果
          .ease(d3[easeName])
          .attr("cx", 200);
      };

      // loopAnimation
      const loop = d3
        .select(".loopAnimation")
        .append("circle")
        .attr("cx", 50)
        .attr("cy", 50)
        .attr("r", 25)
        .attr("fill", "#f68b47")
        .transition()
        .duration(2000)
        .on("start", goRight);

      function goRight() {
        d3.active(this).attr("cx", 200).transition().on("start", goLeft);
      }

      function goLeft() {
        d3.active(this).attr("cx", 50).transition().on("start", goRight);
      }

      // chart animation ====================================
      //定義兩個資料，都是Y值，x值就用陣列索引即可
      const data1 = [
        150, 122, 133, 161, 116, 139, 143, 115, 193, 137, 122, 141,
      ];
      const data2 = [
        180, 146, 180, 172, 133, 149, 152, 138, 188, 192, 117, 146,
      ];

      // svg
      const svg = d3
        .select(".chartAnimation")
        .append("svg")
        .attr("width", 500)
        .attr("height", 300);

      svg
        .selectAll("rect")
        .data(data1)
        .enter()
        .append("rect")
        .attr("x", 0)
        .attr("y", (d, i) => i * 30)
        .attr("width", (d, i) => d)
        .attr("height", 20)
        .attr("fill", "#f68b47");

      // 動畫開始
      d3.select(".chartAnimationBtn").on("click", () => {
        svg
          .selectAll("rect")
          .data(data2) // 資料變化
          .transition() // 加上動畫
          .duration(1000) //點擊之後每個 bar 會在1秒內到達更新位置
          .delay((d, i) => 200 * i) //每個bar在分別delay後才開始動畫，
          // delay 時間乘上index，做出從上至下更新的動畫效果
          .attr("width", (d, i) => d)
          .attr("fill", "#66f9ff");
      });
    </script>
  </body>
</html>
